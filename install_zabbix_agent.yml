---

  - hosts: all
    become: yes
    tasks:
            - name: Install Zabbix agent on CentOS
              yum:
                      name="https://repo.zabbix.com/zabbix/6.4/rhel/7/x86_64/zabbix-agent-6.4.0-release1.el7.x86_64.rpm"
              when:
                      ansible_os_family == "RedHat"
              notify:
                      zabbix-agent systemd

            - name: Install Zabbix agent on Ubuntu
              apt:
                      name=zabbix-agent
                      state=latest
              when:
                      ansible_os_family == "Debian"
              notify:
                      zabbix-agent systemd
            - name: Change zabbix config
              lineinfile:
                      path: /etc/zabbix/zabbix_agentd.conf
                      regexp: '^(.*)Server=(.*)$'
                      line: 'Server=51.250.71.64'
    handlers:
            - name: zabbix-agent systemd
              systemd:
                      name: zabbix-agent.service
                      enabled: yes
                      state: started

